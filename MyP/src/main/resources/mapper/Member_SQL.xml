<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">
	<select id="getMemberList" parameterType="hashmap" resultType="hashmap">
	SELECT M.MEM_NUM, M.ID, M.NM, M.EMAIL, M.WARNING, M.AUTORITY_NM
	FROM( SELECT M.MEM_NUM, M.ID, M.NM, M.EMAIL, M.WARNING, AT.AUTORITY_NM, ROW_NUMBER() OVER(ORDER BY M.MEM_NUM DESC, M.NM DESC) AS RNK
			FROM MEMBER M INNER JOIN AUTORITY AT ON M.autority_num = AT.autority_num
			WHERE WIT_DT IS NULL
			<if test="searchText != null and searchText != ''">
				<choose>
					<when test="searchGbn eq 1">
						AND ID = #{searchText}
					</when>
					<when test="searchGbn eq 2">
						AND NM = #{searchText}
					</when>
					<when test="searchGbn eq 3">
						AND EMAIL LIKE '%' || #{searchText} || '%'
					</when>
					<when test="searchGbn eq 4">
						AND AT.AUTORITY_NM = #{searchText}
					</when>
		        </choose>
		       </if>
	      ) M
	WHERE M.RNK BETWEEN #{start} AND #{end}
	</select>
	
	<select id="getMemberCnt" parameterType="hashmap" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM MEMBER M INNER JOIN AUTORITY AT ON M.autority_num = AT.autority_num
		WHERE WIT_DT IS NULL
		<if test="searchText != null and searchText != ''">
			<choose>
				<when test="searchGbn eq 1">
					AND ID = #{searchText}
				</when>
				<when test="searchGbn eq 2">
					AND NM = #{searchText}
				</when>
				<when test="searchGbn eq 3">
					AND EMAIL LIKE '%' || #{searchText} || '%'
				</when>
				<when test="searchGbn eq 4">
					AND AT.AUTORITY_NM = #{searchText}
				</when>
	        </choose>
	       </if>
	</select>
</mapper>