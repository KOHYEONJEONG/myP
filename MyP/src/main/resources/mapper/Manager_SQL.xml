<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="manager">

	<!-- 관리자 권한 수정(설정, 근데 나중에 권한을 회수하는 것도 생각해야한다.)-->
	<update id="managerAuto" parameterType="hashmap">
		UPDATE MEMBER SET AUTORITY_NUM = 1
		WHERE ID = #{id}
	</update>
	
		<update id="autorityUpdate" parameterType="hashmap">
		UPDATE MEMBER 
		SET 
		<choose>
			<when test="autoritySelectBox eq 1">AUTORITY_NUM = 1</when>
			<when test="autoritySelectBox eq 2">AUTORITY_NUM = 2</when>
			<when test="autoritySelectBox eq 3">AUTORITY_NUM = 3</when>
		</choose>
		WHERE WIT_DT IS NULL
		AND MEM_NUM = #{no2} <!-- 팝업에서 no를 no2로 바꿨다, 기존 회원관리 테이블에 있는 no와 이름이 같아서이다. -->
	</update>
	
	<select id="autority" resultType="hashmap" parameterType="hashmap">
		SELECT AUTORITY_NM
		FROM AUTORITY
	</select>

	<!-- 주차장 데이터 리스트 -->
	<select id="cardataList" resultType="hashmap" parameterType="hashmap">
	SELECT C.CAR_PARK_MAG_NUM, C.CAR_PARK_NM, C.CAR_PARK_TP_NM, C.ADDRESS
	FROM(SELECT CAR_PARK_MAG_NUM,CAR_PARK_NM,ADDRESS,
	ROW_NUMBER() OVER(ORDER BY CAR_PARK_MAG_NUM DESC) AS RNK,
	CASE CAR_PARK_TP_NM WHEN 1 THEN '노상' ELSE '노외' END AS CAR_PARK_TP_NM
	FROM CAR_PARK
	WHERE 1 = 1
	<if test="searchTxt != null and searchTxt != ''">
            <choose>
               <when test="searchGbn == 1">
                  and CAR_PARK_NM LIKE '%' || #{searchTxt} || '%'
               </when>
               
               <when test="searchGbn == 2">
                  and CASE CAR_PARK_TP_NM WHEN 1 THEN '노상' ELSE '노외' END LIKE '%' || #{searchTxt} || '%'
               </when>
               
               <when test="searchGbn == 3">
                  and ADDRESS LIKE '%' || #{searchTxt} || '%'
               </when>
            </choose>
         </if>
	) C
	WHERE C.RNK BETWEEN #{start} AND #{end}
	</select>
	
	<select id="cardatacnt" parameterType="hashmap" resultType="Integer">
	SELECT COUNT(*) AS CNT
	FROM CAR_PARK
	WHERE 1=1
	<if test="searchTxt != null and searchTxt != ''">
            <choose>
               <when test="searchGbn == 1">
                  and CAR_PARK_NM LIKE '%' || #{searchTxt} || '%'
               </when>
               
               <when test="searchGbn == 2">
                  and CASE CAR_PARK_TP_NM WHEN 1 THEN '노상' ELSE '노외' END LIKE '%' || #{searchTxt} || '%'
               </when>
               
               <when test="searchGbn == 3">
                  and ADDRESS LIKE '%' || #{searchTxt} || '%'
               </when>
            </choose>
         </if>
	</select>
	
</mapper>